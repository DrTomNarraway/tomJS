
<!DOCTYPE html>
<html>
<body>
    <script src="jatos.js" id="jatos"></script>
    <script src="tomJS.js" id="tomJS"></script>
    <script>

        // define constants ================================================================================================

        const ABV_BEL     = true;
        const BLOCK_REPS  = 1;
        const COUNTDOWN   = false;
        const CONDITION   = [200, 600];
        const DIFFICULTY  = [0.01, 0.50];
        const ITI_DUR     = [800, 1000, 1200];
        const ORIENTATION = 2;
        const STIM_DUR    = 2000;
        const STIMULUS    = Gabor;
        const TARGET      = ['A', 'B'];
        const TRIAL_REPS  = 1;
        const TOO_FAST    = 0;
        const TOO_SLOW    = 0;

        // set up experiment ===============================================================================================

        const args = {
            'gridlines' : false,
            'rounding' : 5,
            'verbose': true
        };

        const tomJS = new Experiment(args);

        if (jatos.constructor != HTMLScriptElement) jatos.onConnected(()=>{tomJS.connectToJatos(false)});

        const A = tomJS.controls.key_a_upper;
        const B = tomJS.controls.key_b_upper;

        const fontSize = Math.round(0.05 * tomJS.visual.stimulus_size) + "px";

        // trial arguments =================================================================================================

        const _blockwise = {};

        const _trialwise = {
            'condition' : CONDITION,
            'difficulty' : DIFFICULTY,
            'target' : TARGET,
        };

        const _additional = {
            'above_and_below': ABV_BEL,
            'gp_ori': ORIENTATION,
            'iti_duration' : ITI_DUR,
            'stimulus': STIMULUS,
            'stimulus_duration': STIM_DUR,
            'stimulus_fast' : TOO_FAST,
            'stimulus_slow' : TOO_SLOW,
            'warning_at' : 200,
            'warning_for' : 200,
        };

        const _conditional = {};

        // slides ==========================================================================================================

        const _welcome = new Slide([
            { 'class': 'text', 'text': 'DEBUG VERSION', 'y':0.25 },
            { 'class': 'text', 'text': '~tomJS.key~', 'upper': true, 'fontSize': fontSize },
            { 'class': 'text', 'text': 'Press ' + A + ' and ' + B + ' to continue.', 'y': 0.75 }
        ]);

        const _end_block = new EndBlock([
            { 'class': 'text', 'text': 'End of block. Please take a short break.', 'y': 0.25 },
            { 'class': 'text', 'text': 'Accuracy: ~this.data.accuracy~'  , 'y': 0.48},
            { 'class': 'text', 'text': 'Hit Rate: ~this.data.hits~'      , 'y': 0.52},
            { 'class': 'text', 'text': 'Press ' + A + ' and ' + B + ' to continue.', 'y': 0.75 },
        ]);

        const _end_exp = new EndExperiment([
            { 'class': 'text', 'text': 'DEBUG VERSION', 'y': 0.25 },
            { 'class': 'text', 'text': 'Accuracy: ~this.data.accuracy~'  , 'y': 0.48 },
            { 'class': 'text', 'text': 'Hit Rate: ~this.data.hits~'      , 'y': 0.52 },
            { 'class': 'text', 'text': 'Press ' + A + ' and ' + B + ' to end the experiment.', 'y': 0.75 },
        ]);

        // mutators ========================================================================================================

        const _mutator = new Mutator(()=>{tomJS.visual.canvas.requestFullscreen()});

        // timeline ========================================================================================================

        tomJS.appendToTimeline(_welcome);

        tomJS.appendBlock(
            trial_type = ProgressBarResponseSignal,
            trialwise = _trialwise,
            additional = { ..._additional, ...{ 'progress_bar_type': GoalpostBar, 'warning_colour':"White" } },
            conditional = _conditional,
            trial_reps = TRIAL_REPS,
            start_slide = null,
            end_slide = _end_block,
            add_countdown = COUNTDOWN
        );

        tomJS.appendBlock(
            trial_type = ProgressBarResponseSignal,
            trialwise = _trialwise,
            additional = { ..._additional, ...{'progress_bar_type':LeakyBar}},
            conditional = _conditional,
            trial_reps = TRIAL_REPS,
            start_slide = null,
            end_slide = _end_block,
            add_countdown = COUNTDOWN
        );

        tomJS.appendBlock(
            trial_type = ProgressBarResponseSignal,
            trialwise = _trialwise,
            additional = { ..._additional, ...{ 'progress_bar_type': ProgressBar } },
            conditional = _conditional,
            trial_reps = TRIAL_REPS,
            start_slide = null,
            end_slide = _end_block,
            add_countdown = COUNTDOWN
        );

        tomJS.appendBlock(
            trial_type = TextResponseSignal,
            trialwise = _trialwise,
            additional = _additional,
            conditional = _conditional,
            trial_reps = TRIAL_REPS,
            start_slide = null,
            end_slide = _end_block,
            add_countdown = COUNTDOWN
        );

        tomJS.replaceEndBlockWithEndExperiment(_end_exp);

        // run =============================================================================================================

        tomJS.start();

    </script>
</body>
</html>
