
<!DOCTYPE html>
<html>	
<body>
<script src="jatos.js" id="jatos"></script>
<script src="tomJS.js" id="tomJS"></script>
<script>

    // define constants ====================================================================================================

    const BLOCK_REPS  = 1;
    const CONDITION   = [0.200, 0.500, 0.800];
    const DIFFICULTY  = [0.01, 0.03, 0.50];
    const FAST        = 0.000;
    const ORIENTATION = 2;
    const SLOW        = 0.350;
    const SIZE        = 1;
    const STIMULUS    = Gabor;
    const TRIAL_REPS  = 1;
    const TRIAL_TYPE  = VisualResponseSignal;

    // set up experiment ===================================================================================================
    
    const args = { 
        'contacts' : ["Tom Narraway: narraway@uni-bremen.de", "Heinrich Liesefeld: heinrich.liesefeld@uni-bremen.de"],
        'verbose' : true,
    };


    const vrs_obligs = "The success of scientific studies depends significantly on your cooperation."+
		" We therefore ask you to remain focused and to work according to the instructions throughout the entire study. In order to demonstrate your focus you must also respond correctly on at least 60% of trials, and respond at the indicated time on at least 85% of trials."
    updateConsentForm('value', 'Obligations', vrs_obligs);
    
    const tomJS = new Experiment(args);

    if (jatos.constructor != HTMLScriptElement) jatos.onConnected(()=>{tomJS.connectToJatos(false)});

    const A = tomJS.controls.key_a_upper;
    const B = tomJS.controls.key_b_upper;

    const max_cond = arrayMax(CONDITION);
    const min_cond = arrayMin(CONDITION);
    const max_diff = arrayMax(DIFFICULTY);
    const min_diff = arrayMin(DIFFICULTY);

    const fontSize = Math.round(0.05 * tomJS.visual.stimulus_size) + "px";

    // trial arguments =====================================================================================================

    const _blockwise = {};
    
    const _trialwise = {
        'condition' : CONDITION,
        'difficulty' : DIFFICULTY,
        'target' : ['A', 'B'],
    };
    
    const _additional = {
        'stimulus' : STIMULUS,
        'gp_ori' : ORIENTATION,
        'gp_size' : SIZE,
        'stimulus_fast' : FAST,
        'stimulus_slow' : SLOW,
    };
    
    // slides ==============================================================================================================
    
    const welcome = new Slide([
        { 'class' : 'text', 'text' : 'Please press ' + A + ' and then ' + B + ' a few times to make sure your ', 'y' : 0.25 },
        { 'class' : 'text', 'text' : 'keyboard is being read by the experiment correctly.', 'y' : 0.30 },
        { 'class' : 'text', 'text' : '~key~' , 'upper' : true, 'fontSize':fontSize},
        { 'class' : 'text', 'text' : 'Press ' + A + ' and ' + B + ' to continue.', 'y' : 0.75 },
    ]);
    
    const stimulus = new Slide([
        { 'class' : 'text', 'text' : 'On each trial you will see a stimulus like the one below. Press ' + A + ' if ', 'y' : 0.15 },
        { 'class' : 'text', 'text' : 'you think the stimulus is rotated to the left, or press ' + B, 'y' : 0.20 },
        { 'class' : 'text', 'text' : 'if you think it is rotated to the right. Press ' + A + ' and ' + B + ' now to see examples.', 'y' : 0.25 },
        { 'class' : 'gabor', 'gp_size' : 0.5, 'difficulty' : max_diff, 'gp_ori' : ORIENTATION},
        { 'class' : 'text', 'text' : 'Press ' + A + ' and ' + B + ' to continue.', 'y' : 0.75 },
    ]);

    const sat = new ExampleVisualResponseSignal([
        { 'class' : 'text', 'text' : 'On each trial you you will see a bar at the top of the screen like the one below.', 'y' : 0.25 },
        { 'class' : 'text', 'text' : 'You must respond while the bar is blue.', 'y' : 0.30 },
        { 'class' : 'text', 'text' : 'Press ' + A + ' and ' + B + ' to continue.', 'y' : 0.75 },
    ], {'max' : 2.000});
    
    const end_block = new EndBlock([
        { 'class' : 'text', 'text' : 'End of block. Please take a short break. ', 'y' : 0.25 },
        { 'class' : 'text', 'text' : 'You responded while the bar was blue on ^hits^% of trials this block.' },
        { 'class' : 'text', 'text' : 'Press ' + A + ' and ' + B + ' to continue.', 'y' : 0.75 },
    ]);         
    
    const end_exp = new EndExperiment([
        { 'class' : 'text', 'text' : 'End of Experiment. Thank you for your help.', 'y' : 0.25 },
        { 'class' : 'text', 'text' : 'You responded while the bar was blue on ^hits^% of trials this experiment.' },
        { 'class' : 'text', 'text' : 'Press ' + A + ' and ' + B + ' to end the experiment.', 'y' : 0.75 },
    ]);

    // timeline ============================================================================================================
    
    tomJS.appendToTimeline(welcome);
    tomJS.appendToTimeline(stimulus);
    tomJS.appendToTimeline(sat);
    
    tomJS.appendBlocks(TRIAL_TYPE, _blockwise, _trialwise, _additional, BLOCK_REPS, TRIAL_REPS, start_block=null, end_block, add_countdown=true);
    
    tomJS.replaceEndBlockWithEndExperiment(end_exp);
    
    // run =================================================================================================================
    
    if (tomJS.verbose) console.log(tomJS.timeline);
    
    tomJS.start();

</script>
</body>
</html>
